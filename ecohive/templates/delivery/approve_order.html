{% extends 'delivery/base.html' %}
{% load static %}

{% block content %}

<div class="container">
    <div class="card mt-5">
        <div class="card-body">
            <div class="container">
                <h2>Assigned Orders</h2>
                {% for assigned_order in assigned_orders %}
                    <div class="order">
                        <h3>Order ID: {{ assigned_order.order.id }}</h3>
                        <p>Seller: {{ assigned_order.seller.name }}</p>
                        <p>Billing Details: {{ assigned_order.billingdetails }}</p>
                        <!-- Display order items -->
                        {% for order_item in assigned_order.order.orderitem_set.all %}
                            <div class="order-item">
                                <p>Product: {{ order_item.product.product_name }}</p>
                                <p>Quantity: {{ order_item.quantity }}</p>
                                <p>Price: ${{ order_item.price }}</p>
                                <!-- Add QR code scanning field -->
                                <label for="qr_code">Scan QR Code to Confirm:</label>
                                <li class="nav-item nav-settings d-none d-lg-block">
                                    <a class="nav-link" onclick="openQrScannerModal()" id="scanQrCodeBtn">
                                      <i class="mdi mdi-qrcode-scan"></i>
                                    </a>
                                </li>
                                <!-- Add a button to submit the QR code -->
                                <button onclick="confirmOrder({{ order_item.id }})">Confirm QR</button>
                                <!-- Add a button to confirm delivery -->
                                {% comment %} <button onclick="confirmDelivery({{ order_item.id }})">Confirm Delivery</button> {% endcomment %}
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% comment %} <script>
    function confirmDelivery(orderItemId) {
        $.ajax({
            type: 'POST',
            url: '/confirm_delivery/', // URL to your Django view
            data: {
                'order_item_id': orderItemId,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                if (response.success) {
                    // Order delivery confirmed successfully
                    alert('Order delivery confirmed successfully');
                    // Optionally, update the UI to reflect the confirmed delivery
                } else {
                    alert('Failed to confirm delivery: ' + response.error);
                }
            },
            error: function (xhr, status, error) {
                alert('Error occurred while confirming delivery');
                console.error(error);
            }
        });
    }
</script> {% endcomment %}
{% comment %} <div class="content-wrapper">
    <div id="qrScannerModal" class="modal">

      <div class="modal-content" style="width: 500px; margin: 0 auto; margin-top:100px;">
          <button class="close-modal btn btn-danger" onclick="closeQrScannerModal()" >&times;</button>
          <h5 class="card-title" style="margin-top:10px;">Place the QR Code in this space</h5>
          <input type="file" id="fileInput" accept="image/*">
          <button onclick="scanQRCodeFromFile()" class="btn btn-primary" style="margin-top:10px;">Scan from File</button>
          <video id="qrScanner" width="100%" height="100%"></video>
      </div>
  </div> {% endcomment %}
{% endblock %}

<!-- Add these links to your base.html or HTML file -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
